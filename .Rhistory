trt_effect[1:max(min(start_cycle,n+1),0)]=startHR
if (end_cycle > start_cycle)
{
for (t in (start_cycle):max(end_cycle,n))
{
trt_effect[t+1]=startHR+(t+1-start_cycle)*(endHR-startHR)/(end_cycle-start_cycle)
}
}
if(end_cycle<n+1)
{
trt_effect[(end_cycle+1):n+1]=endHR
}
# Combine treatment effect with discontinuations and return the cohort-level treatment effect
return(trt_effect*on_trt+(1-on_trt))
}
fe_mi_HR=timedep_trt_eff(
"start_yr"=71,
"end_yr"=71,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.05
)
ceiling(start_yr*365)
ceiling(71*365)
ceiling(71*365):round(71*365)
ceiling(71*365):(round(71*365)+1)
1:0
start_yr=end_yr=71
start_HR=0.6
end_HR=1
annual_discontinuation_rate=0.05
n=round((prediction_years+1)*365)
per_cycle_disc=1-(1-annual_discontinuation_rate)^(1/365)
on_trt=(1-per_cycle_disc)^seq(0,n)
start_cycle=ceiling(start_yr*365)
end_cycle=ceiling(end_yr*365)
trt_effect=rep(1,n+1)
trt_effect[1:max(min(start_cycle,n+1),1)]=startHR
startHR=start_HR
endHR=end_HR
trt_effect[1:max(min(start_cycle,n+1),1)]=startHR
if (end_cycle > start_cycle)
{
for (t in (start_cycle):max(end_cycle,n))
{
trt_effect[t+1]=startHR+(t+1-start_cycle)*(endHR-startHR)/(end_cycle-start_cycle)
}
}
if(end_cycle<n+1)
{
trt_effect[(end_cycle+1):n+1]=endHR
}
trt_effect[(end_cycle+1):n+1]
end_cycle
end_cycle+1
n+1
25916:25916
(end_cycle+1):n+1
(end_cycle+1):(n+1)
timedep_trt_eff=function(start_yr=1,end_yr=1,startHR=1,endHR=1,annual_discontinuation_rate=0)
{
# Number of cycles
n=round((prediction_years+1)*365)
# Proportion on treatment by cycle
per_cycle_disc=1-(1-annual_discontinuation_rate)^(1/365)
on_trt=(1-per_cycle_disc)^seq(0,n)
# Calculate time-dependent treatment effect for those still on treatment
start_cycle=ceiling(start_yr*365)
end_cycle=ceiling(end_yr*365)
trt_effect=rep(1,n+1)
trt_effect[1:max(min(start_cycle,n+1),1)]=startHR
if (end_cycle > start_cycle)
{
for (t in (start_cycle):max(end_cycle,n))
{
trt_effect[t+1]=startHR+(t+1-start_cycle)*(endHR-startHR)/(end_cycle-start_cycle)
}
}
if(end_cycle<n+1)
{
trt_effect[(end_cycle+1):(n+1)]=endHR
}
# Combine treatment effect with discontinuations and return the cohort-level treatment effect
return(trt_effect*on_trt+(1-on_trt))
}
fe_mi_HR=timedep_trt_eff(
"start_yr"=71,
"end_yr"=71,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.05
)
fe_mi_HR=timedep_trt_eff(
"start_yr"=-2,
"end_yr"=71,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.05
)
fe_mi_hr
fe_mi_HR
head(fe_mi_HR)
tail(fe_mi_HR)
fe_mi_HR=timedep_trt_eff(
"start_yr"=-2,
"end_yr"=10,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.05
)
tail(fe_mi_HR)
head(fe_mi_HR)
timedep_trt_eff=function(start_yr=1,end_yr=1,startHR=1,endHR=1,annual_discontinuation_rate=0)
{
# if no waning effect then set both start and end to prediction years +1
if (end_yr < 0)
{
start_yr=end_yr=prediction_years+1
}
# Number of cycles
n=round((prediction_years+1)*365)
# Proportion on treatment by cycle
per_cycle_disc=1-(1-annual_discontinuation_rate)^(1/365)
on_trt=(1-per_cycle_disc)^seq(0,n)
# Calculate time-dependent treatment effect for those still on treatment
start_cycle=min(ceiling(start_yr*365),n+1)
end_cycle=min(ceiling(end_yr*365),n+1)
trt_effect=rep(1,n+1)
trt_effect[1:start_cycle]=startHR
if (end_cycle > start_cycle)
{
for (t in (start_cycle:(end_cycle-1)))
{
trt_effect[t+1]=startHR+(t+1-start_cycle)*(endHR-startHR)/(end_cycle-start_cycle)
}
}
trt_effect[end_cycle:(n+1)]=endHR
# Combine treatment effect with discontinuations and return the cohort-level treatment effect
return(trt_effect*on_trt+(1-on_trt))
}
fe_mi_HR=timedep_trt_eff(
"start_yr"=-2,
"end_yr"=10,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.05
)
timedep_trt_eff=function(start_yr=1,end_yr=1,startHR=1,endHR=1,annual_discontinuation_rate=0)
{
# if no waning effect then set both start and end to prediction years +1
if (end_yr < 0)
{
start_yr=end_yr=prediction_years+1
}
if (start_yr<0)
{
start_yr=end_yr
}
# Number of cycles
n=round((prediction_years+1)*365)
# Proportion on treatment by cycle
per_cycle_disc=1-(1-annual_discontinuation_rate)^(1/365)
on_trt=(1-per_cycle_disc)^seq(0,n)
# Calculate time-dependent treatment effect for those still on treatment
start_cycle=min(ceiling(start_yr*365),n+1)
end_cycle=min(ceiling(end_yr*365),n+1)
trt_effect=rep(1,n+1)
trt_effect[1:start_cycle]=startHR
if (end_cycle > start_cycle)
{
for (t in (start_cycle:(end_cycle-1)))
{
trt_effect[t+1]=startHR+(t+1-start_cycle)*(endHR-startHR)/(end_cycle-start_cycle)
}
}
trt_effect[end_cycle:(n+1)]=endHR
# Combine treatment effect with discontinuations and return the cohort-level treatment effect
return(trt_effect*on_trt+(1-on_trt))
}
fe_mi_HR=timedep_trt_eff(
"start_yr"=-2,
"end_yr"=10,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.05
)
prediction_years=1
fe_mi_HR=timedep_trt_eff(
"start_yr"=-2,
"end_yr"=10,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.05
)
fe_mi_HR
timedep_trt_eff=function(start_yr=1,end_yr=1,startHR=1,endHR=1,annual_discontinuation_rate=0)
{
# if no waning effect then set both start and end to prediction years +1
if (end_yr < 0)
{
start_yr=end_yr=prediction_years+1
}
if (start_yr<0)
{
start_yr=end_yr
}
# Number of cycles
n=round((prediction_years+1)*365)
# Proportion on treatment by cycle
per_cycle_disc=1-(1-annual_discontinuation_rate)^(1/365)
on_trt=(1-per_cycle_disc)^seq(0,n)
# Calculate time-dependent treatment effect for those still on treatment
start_cycle=min(ceiling(start_yr*365),n+1)
end_cycle=min(ceiling(end_yr*365),n+1)
trt_effect=rep(1,n+1)
trt_effect[1:start_cycle]=startHR
if (end_cycle > start_cycle)
{
for (t in (start_cycle:(end_cycle-1)))
{
trt_effect[t+1]=startHR+(t+1-start_cycle)*(endHR-startHR)/(end_cycle-start_cycle)
}
}
#trt_effect[end_cycle:(n+1)]=endHR
# Combine treatment effect with discontinuations and return the cohort-level treatment effect
return(trt_effect*on_trt+(1-on_trt))
}
fe_mi_HR=timedep_trt_eff(
"start_yr"=-2,
"end_yr"=10,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.05
)
fe_mi_HR
timedep_trt_eff=function(start_yr=1,end_yr=1,startHR=1,endHR=1,annual_discontinuation_rate=0)
{
# if no waning effect then set both start and end to prediction years +1
if (end_yr < 0)
{
start_yr=end_yr=prediction_years+1
}
if (start_yr<0)
{
start_yr=end_yr
}
# Number of cycles
n=round((prediction_years+1)*365)
# Proportion on treatment by cycle
per_cycle_disc=1-(1-annual_discontinuation_rate)^(1/365)
on_trt=(1-per_cycle_disc)^seq(0,n)
# Calculate time-dependent treatment effect for those still on treatment
start_cycle=min(ceiling(start_yr*365),n+1)
end_cycle=min(ceiling(end_yr*365),n+1)
trt_effect=rep(1,n+1)
trt_effect[1:start_cycle]=startHR
if (end_cycle > start_cycle)
{
for (t in (start_cycle:(end_cycle-1)))
{
trt_effect[t+1]=startHR+(t+1-start_cycle)*(endHR-startHR)/(end_cycle-start_cycle)
}
}
if (end_cycle<(n+1))
{
trt_effect[end_cycle:(n+1)]=endHR
}
# Combine treatment effect with discontinuations and return the cohort-level treatment effect
return(trt_effect*on_trt+(1-on_trt))
}
fe_mi_HR=timedep_trt_eff(
"start_yr"=-2,
"end_yr"=10,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.05
)
fe_mi_HR
fe_mi_HR=timedep_trt_eff(
"start_yr"=-2,
"end_yr"=-2,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.05
)
fe_mi_HR
timedep_trt_eff=function(start_yr=1,end_yr=1,startHR=1,endHR=1,annual_discontinuation_rate=0)
{
# if no waning effect then set both start and end to prediction years +1
if (end_yr < 0)
{
start_yr=end_yr=prediction_years+1
}
if (start_yr<0)
{
start_yr=end_yr
}
# Number of cycles
n=round((prediction_years+1)*365)
# Proportion on treatment by cycle
per_cycle_disc=1-(1-annual_discontinuation_rate)^(1/365)
on_trt=(1-per_cycle_disc)^seq(0,n)
# Calculate time-dependent treatment effect for those still on treatment
start_cycle=min(ceiling(start_yr*365),n+1)
end_cycle=min(ceiling(end_yr*365),n+1)
trt_effect=rep(1,n+1)
trt_effect[1:start_cycle]=startHR
if (end_cycle > start_cycle)
{
for (t in (start_cycle:(end_cycle-1)))
{
trt_effect[t+1]=startHR+(t+1-start_cycle)*(endHR-startHR)/(end_cycle-start_cycle)
}
}
if (end_cycle<(n+1))
{
trt_effect[end_cycle:(n+1)]=endHR
}
# Combine treatment effect with discontinuations and return the cohort-level treatment effect
return(trt_effect*on_trt+(1-on_trt))
}
timedep_trt_eff(
"start_yr"=-2,
"end_yr"=-2,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.05
)
timedep_trt_eff(
"start_yr"=-2,
"end_yr"=-2,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.00
)
timedep_trt_eff=function(start_yr=1,end_yr=1,startHR=1,endHR=1,annual_discontinuation_rate=0)
{
# if no waning effect then set both start and end to prediction years +1
if (end_yr < 0)
{
start_yr=end_yr=prediction_years+1
}
else if (start_yr<0)
{
start_yr=end_yr
}
# Number of cycles
n=round((prediction_years+1)*365)
# Proportion on treatment by cycle
per_cycle_disc=1-(1-annual_discontinuation_rate)^(1/365)
on_trt=(1-per_cycle_disc)^seq(0,n)
# Calculate time-dependent treatment effect for those still on treatment
start_cycle=min(ceiling(start_yr*365),n+1)
end_cycle=min(ceiling(end_yr*365),n+1)
trt_effect=rep(1,n+1)
trt_effect[1:start_cycle]=startHR
if (end_cycle > start_cycle)
{
for (t in (start_cycle:(end_cycle-1)))
{
trt_effect[t+1]=startHR+(t+1-start_cycle)*(endHR-startHR)/(end_cycle-start_cycle)
}
}
if (end_cycle<(n+1))
{
trt_effect[end_cycle:(n+1)]=endHR
}
# Combine treatment effect with discontinuations and return the cohort-level treatment effect
return(trt_effect*on_trt+(1-on_trt))
}
timedep_trt_eff(
"start_yr"=-2,
"end_yr"=-2,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.00
)
timedep_trt_eff=function(start_yr=1,end_yr=1,startHR=1,endHR=1,annual_discontinuation_rate=0)
{
# if no waning effect then set both start and end to prediction years +1
if (end_yr < 0)
{
start_yr=end_yr=prediction_years+1
}
else if (start_yr<0)
{
start_yr=end_yr
}
# Number of cycles
n=round((prediction_years+1)*365)
# Proportion on treatment by cycle
per_cycle_disc=1-(1-annual_discontinuation_rate)^(1/365)
on_trt=(1-per_cycle_disc)^seq(0,n)
# Calculate time-dependent treatment effect for those still on treatment
start_cycle=min(ceiling(start_yr*365),n+1)
end_cycle=min(ceiling(end_yr*365),n+1)
trt_effect=rep(1,n+1)
trt_effect[1:start_cycle]=startHR
if (end_cycle > start_cycle)
{
for (t in (start_cycle:(end_cycle-1)))
{
trt_effect[t+1]=startHR+(t+1-start_cycle)*(endHR-startHR)/(end_cycle-start_cycle)
}
}
# if (end_cycle<(n+1))
#    {
#    trt_effect[end_cycle:(n+1)]=endHR
#   }
# Combine treatment effect with discontinuations and return the cohort-level treatment effect
return(trt_effect*on_trt+(1-on_trt))
}
timedep_trt_eff(
"start_yr"=-2,
"end_yr"=-2,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.00
)
start_yr=-1
end_yr=-1
startHR=0.6
endHR=1
annual_discontinuation_rate=0
if (end_yr < 0)
{
start_yr=end_yr=prediction_years+1
}
else if (start_yr<0)
{
start_yr=end_yr
}
n=round((prediction_years+1)*365)
# Proportion on treatment by cycle
per_cycle_disc=1-(1-annual_discontinuation_rate)^(1/365)
on_trt=(1-per_cycle_disc)^seq(0,n)
start_cycle=min(ceiling(start_yr*365),n+1)
end_cycle=min(ceiling(end_yr*365),n+1)
trt_effect=rep(1,n+1)
tail(trt_effect)
trt_effect[1:start_cycle]=startHR
tail(trt_effect)
timedep_trt_eff=function(start_yr=1,end_yr=1,startHR=1,endHR=1,annual_discontinuation_rate=0)
{
# if no waning effect then set both start and end to prediction years +1
if (end_yr < 0)
{
start_yr=end_yr=prediction_years+1
}
else if (start_yr<0)
{
start_yr=end_yr
}
# Number of cycles
n=round((prediction_years+1)*365)
# Proportion on treatment by cycle
per_cycle_disc=1-(1-annual_discontinuation_rate)^(1/365)
on_trt=(1-per_cycle_disc)^seq(0,n)
# Calculate time-dependent treatment effect for those still on treatment
start_cycle=min(ceiling(start_yr*365)+1,n+1)
end_cycle=min(ceiling(end_yr*365)+1,n+1)
trt_effect=rep(1,n+1)
trt_effect[1:start_cycle]=startHR
if (end_cycle > start_cycle)
{
for (t in (start_cycle:(end_cycle-1)))
{
trt_effect[t+1]=startHR+(t+1-start_cycle)*(endHR-startHR)/(end_cycle-start_cycle)
}
}
if (end_cycle<(n+1))
{
trt_effect[end_cycle:(n+1)]=endHR
}
# Combine treatment effect with discontinuations and return the cohort-level treatment effect
return(trt_effect*on_trt+(1-on_trt))
}
timedep_trt_eff(
"start_yr"=-2,
"end_yr"=-2,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.00
)
timedep_trt_eff(
"start_yr"=-2,
"end_yr"=5,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.00
)
timedep_trt_eff(
"start_yr"=1,
"end_yr"=2,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.00
)
fe_mi_HR=timedep_trt_eff(
"start_yr"=1,
"end_yr"=1,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.00
)
timedep_trt_eff(
"start_yr"=1,
"end_yr"=1,
"startHR"=0.6,
"endHR"=1,
"annual_discontinuation_rate"=0.00
)
